## Topic

### Topic 定义

发送到 `Topic交换机` 的报文不能随意定义 `routing_key`，它必须是一个**用点分隔**的单词列表。

这些单词可以是任何内容，但通常会指定与信息相关的一些特征。

以下是几个有效的路由密钥示例 `stock.usd.nyse`、`nyse.vmw`、`quick.orange.rabbit`。路由密钥的字数不限，最多 255 字节。

绑定密钥也必须采用相同的形式。

`Topic交换机` 背后的逻辑与 `direct交换机` 类似，使用特定路由密钥发送的信息将被传送到所有使用匹配绑定密钥绑定的队列。

##### 不过，绑定密钥有两种重要的特殊情况：

- *：可以完全替代一个单词。
- #：可以替代零个或多个单词。

### Topic 示例

##### 在下图中，Q1 和 Q2 绑定的关系如下：

- Q1：中间是orange带3个单词的字符串(*.orange. *)
- Q2：最后一个单词是 rabbit 的3个单词(*. *.rabbit)
- 第一个单词是 lazy 的多个单词(lazy.#)

```
                type=topic
                     │
                     │
                     ↓
    ┌───┐        ┌───────┐ *.orange.*    ┌───┐         ┌───┐
    │ P │───────→│   X   │──────────────→│Q1 │───────→ │C1 │
    └───┘        └───────┘               │███│         └───┘
                     │                   └───┘
                     │ *.*.rabbit
                     │ lazy.#
                     │
                     ↓
                 ┌───────┐        ┌───┐
                 │  Q2   │───────→│C2 │
                 │███████│        └───┘
                 └───────┘
                 
```

上图是一个队列绑定关系图，下面给出一些哪些交换机的名称能够与队列绑定示例：

| 路由键名称                    | Q1队列 | Q2队列 |
|--------------------------|------|------|
| quick.orange.rabbit      | Y    | Y    |
| lazy.orange.elephant     | Y    | Y    |
| quick.orange.fox         | Y    | N    |
| lazy.brown.fox           | N    | Y    |
| lazy.pink.rabbit         | N    | Y    |
| quick.brown.fox          | N    | N    |
| quick.orange.male.rabbit | N    | N    |
| lazy.orange.male.rabbit  | N    | Y    |

当队列使用 `#` 绑定键绑定时，无论路由键是什么，它都将接收所有信息，就像 `fanout` 类型一样。

如果绑定中没有使用特殊字符 `*` 和 `#`，则 `topic交换机` 的行为与 `direct交换机` 相同。

## 本示例运行方式

* 1 运行 `R2_消费者` 和 `R3_消费者`
* 2 运行 `R1_生产者`
