## 队列持久化 和 消息持久化

### 队列持久化

在前面创建的队列都是**非持久化**的，如果重启 RabbitMQ，该队列就会被删除，要实现队列持久化，需要在声明队列的时候将**durable**
参数设置为持久化。

但是需要注意，如果之前声明的队列不是持久化的，需要将原队列先删除，或者重新创建一个新的持久化的队列，不能直接在原队列上修改参数值使非持久化队列转为持久化队列，直接修改重启生产者时会出现错误。

### 消息持久化

要使消息实现持久化需要在**生产者发布消息**时指定属性`MessageProperties.PERSISTENT_TEXT_PLAIN`，将消息标记为持久化，但是并不能保证完成不丢失消息。

尽管它告诉 RabbitMQ将消息存储到磁盘，但是依然存在当消息刚准备存储到磁盘或者消息并没有完全存储到磁盘的过程中，消息还在缓存的一个间隔点。

此时并没有真正的写入磁盘。

持久性保证并不强，但是对于简单任务队列来说已经足够了。

### 测试方法:

* 1 运行 `G3_运行`
* 2 重启 `rabbitmq` 查看队列里面的数量
