## 批量的同步发布确认模式

与等待单条消息的确认相比，等待一批消息的确认可大幅提高吞吐量（远程 RabbitMQ 节点的确认次数可达 20-30 次）。

但是却有一个缺点，如果发生故障，我们无法确切知道出错的原因，因此我们可能需要在内存中保留整批消息，以便记录有意义的信息或重新发布消息。

而且这种解决方案仍然是同步的，因此会阻止消息的发布。

### 改造

```java
// 原本单条确认 boolean flag = 信道.waitForConfirms();

// 改成 每发送100条消息确认一次
if (i % batchSize == 0) {
    信道.waitForConfirms();
}
```

### 测试方法:

* 1 运行 `K1_生产者`
